"use client";
import CountryDropdown from "@/src/components/Common/CountryDropdown";
import { CustomInputField } from "@/src/components/forms";
import { profileCompanyInfoForm } from "@/src/components/lib/columns/clients";
import useCountrySelector from "@/src/hooks/useCountryList";
import { fetchClientBusinessProfile } from "@/src/redux/features/enterprise/client/clientThunks";
import { getCountryCallingCode } from "libphonenumber-js";
import { useParams } from "next/navigation";
import { useCallback, useEffect, useState } from "react";
import { useDispatch, useSelector } from "react-redux";

export default function BusinessProfile() {
  const dispatch = useDispatch();
  const { id } = useParams();
  const { clientBusinessProfile: profile, loading } = useSelector(
    (state) => state.enterpriseClient,
  );

  useEffect(() => {
    if (id && !profile) {
      dispatch(fetchClientBusinessProfile({ id }));
    }
  }, [dispatch, id, profile]);

  const defaultCountryCode = profile?.countryCode || "US";
  const {
    selectedCountry,
    showCountryDropdown,
    filteredCountries,
    countrySearch,
    handleCountrySelect,
    toggleDropdown,
    updateSearch,
  } = useCountrySelector(defaultCountryCode);

  const [formData, setFormData] = useState({
    companyName: profile?.companyName || "",
    aboutCompany: profile?.aboutCompany || "",
    countryCode: defaultCountryCode,
    countryDialCode:
      profile?.countryDialCode ||
      `+${getCountryCallingCode(defaultCountryCode)}`,
    mobileNumber: profile?.mobileNumber || "",
    emailId: profile?.emailId || "",
    websiteLink: profile?.websiteLink || "",
    fb: profile?.fb || "",
    instagram: profile?.instagram || "",
    x: profile?.x || "",
    youTube: profile?.youTube || "",
    whatsapp: profile?.whatsapp || "",
    pinterest: profile?.pinterest || "",
    behance: profile?.behance || "",
  });

  const [errors, setErrors] = useState({});

  const handleChange = useCallback(
    (name, e, rqd = true) => {
      const { value } = e.target;
      if (rqd)
        setErrors((prev) => ({
          ...prev,
          [name]: value ? "" : `${name} is required`,
        }));

      setFormData((prev) => ({ ...prev, [name]: value }));
    },
    [errors],
  );

  return (
    <form className="grid grid-cols-1 xl:grid-cols-2 xl:gap-4 gap-3">
      {profileCompanyInfoForm.map((item) => (
        <div className="flex gap-2" key={item.field}>
          {item.field === "mobileNumber" && (
            <CountryDropdown
              selectedCountry={selectedCountry}
              showDropdown={showCountryDropdown}
              filteredCountries={filteredCountries}
              searchValue={countrySearch}
              onToggle={toggleDropdown}
              onCountrySelect={handleCountrySelect}
              onSearchChange={updateSearch}
              className="mt-6"
            />
          )}
          <CustomInputField
            {...item}
            error={errors[item.field]}
            value={formData[item.field]}
            onChange={(e) => handleChange(item.field, e, item?.rqd)}
          />
        </div>
      ))}

      <div className="col-span-full">
        <button
          type="submit"
          className="md:static fixed bottom-0 left-0 right-0 z-30 bg-primary text-white px-4 py-2 rounded hover:bg-secondary transition"
        >
          Save
        </button>
      </div>
    </form>
  );
}



import mongoose, { Schema } from "mongoose";
import { AccountStatus, ClientType } from "../utils/enums/index.js";

const profileSchema = new Schema(
  {
    companyName: { type: String },
    aboutCompany: { type: String },
    countryCode: { type: String },
    countryDialCode: { type: String },
    countryName: { type: String },
    mobileNumber: { type: String },
    emailId: { type: String },
    websiteLink: { type: String },
    colorThemeCode: { type: String },
    profilePhoto: { type: String },
    coverPhoto: { type: String },
    fb: { type: String },
    instagram: { type: String },
    x: { type: String },
    youTube: { type: String },
    whatsapp: { type: String },
    pinterest: { type: String },
    behance: { type: String },
    setupProgress: { type: Number, default: 0 },
    isSetupComplete: { type: Boolean, default: false },
    clientType: {
      type: String,
      enum: Object.values(ClientType),
      required: true,
    },
    clientId: {
      type: Schema.Types.ObjectId,
      required: true,
      refPath: "clientTypeModel",
    },
    clientTypeModel: {
      type: String,
      enum: ["photographerClient", "enterpriseClient"],
      required: true,
    },
    status: {
      type: String,
      enum: Object.values(AccountStatus),
      default: "activate",
    },
    clientId: { type: Schema.Types.ObjectId, ref: "client" },
    deletedAt: { type: Date, default: null },
  },
  { timestamps: true }
);
profileSchema.index({ clientId: 1 });

export default mongoose.model("profile", profileSchema);



