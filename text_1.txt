import Link from "next/link";
import React, { useMemo, useState } from "react";
import {
  FiFolder,
  FiImage,
  FiChevronLeft,
  FiSettings,
  FiShare2,
  FiCalendar,
  FiClock,
  FiMoreHorizontal,
  FiX,
  FiMapPin,
  FiShield,
  FiLayers,
} from "react-icons/fi";

const InfoItem = ({ icon: Icon, label, value, highlight = false }) => (
  <div
    className={`flex items-center gap-1 px-2 py-1 rounded-lg ${
      highlight ? "bg-secondary/10 border border-secondary/20" : "bg-gray-50"
    }`}
  >
    <Icon className="text-secondary text-sm flex-shrink-0" />
    <span
      className={`text-xs font-medium truncate ${
        highlight ? "text-primary" : "text-third"
      }`}
    >
      {value}
    </span>
    <span className="text-xs text-gray-500 flex-shrink-0">{label}</span>
  </div>
);

const ActionButton = ({ icon: Icon, label, href }) => (
  <Link
    href={href}
    passHref
    className="bg-gradient-to-r from-secondary to-[#e8d4a6] text-primary px-2 py-1 rounded-lg font-medium hover:from-[#c9b085] hover:to-secondary transition-all flex items-center gap-1 shadow-sm hover:shadow-md text-xs"
    aria-label={label}
    title={label}
  >
    <Icon className="text-sm" />
    <span className="inline">{label}</span>
  </Link>
);

const Header = ({
  oneEvent,
  sidebarVisible,
  setSidebarVisible,
  packageMB = 0,
}) => {
  const [showStatsModal, setShowStatsModal] = useState(false);

  const actions = useMemo(
    () => [
      {
        icon: FiSettings,
        label: "Settings",
        value: "settings",
        href: `/event/${oneEvent?._id}/settings`,
      },
      {
        icon: FiShare2,
        label: "Share",
        value: "share",
        href: `/common-qr?event_id=${oneEvent?._id}`,
      },
    ],
    [oneEvent]
  );

  // Format dates properly
  const formatEventDate = (dateString) => {
    if (!dateString) return "N/A";
    const date = new Date(dateString);
    return date.toLocaleDateString("en-US", {
      day: "2-digit",
      month: "short",
      year: "numeric",
    });
  };

  const stats = useMemo(
    () => [
      {
        icon: FiFolder,
        label: "Albums",
        value: oneEvent?.totalAlbums || 0,
        highlight: (oneEvent?.totalAlbums || 0) > 0,
      },
      {
        icon: FiImage,
        label: "Photos",
        value: oneEvent?.totalPhotos || 0,
        highlight: (oneEvent?.totalPhotos || 0) > 0,
      },
    ],
    [oneEvent, packageMB]
  );

  const eventDetails = useMemo(
    () => [
      {
        icon: FiCalendar,
        label: "Start",
        value: formatEventDate(oneEvent?.eventStartDate),
      },
      {
        icon: FiClock,
        label: "End",
        value: formatEventDate(oneEvent?.eventEndDate),
      },
      {
        icon: FiMapPin,
        label: "Location",
        value: oneEvent?.location || "N/A",
      },
      {
        icon: FiShield,
        label: "PIN",
        value: oneEvent?.accessPin || "N/A",
      },
    ],
    [oneEvent]
  );

  // Calculate storage percentage
  const storagePercentage = useMemo(() => {
    const used = oneEvent?.totalMBUsed || 0;
    return Math.min((used / packageMB) * 100, 100);
  }, [oneEvent?.totalMBUsed, packageMB]);

  return (
    <>
      <header className="sticky top-0 z-20 bg-white/95 backdrop-blur-sm border-b border-gray-200/60 px-2 pb-2">
        <div className="flex items-center justify-between gap-2">
          <div className="flex items-center gap-2 min-w-0 flex-1">
            <button
              onClick={() => setSidebarVisible(!sidebarVisible)}
              className="xl:hidden flex items-center gap-2 flex-shrink-0 px-3 py-1.5 rounded-lg text-primary bg-gradient-to-r from-secondary/20 to-secondary/10 hover:from-secondary/30 hover:to-secondary/20 transition-all border border-secondary/30 hover:border-secondary/50"
              aria-label={sidebarVisible ? "Hide sidebar" : "Show sidebar"}
            >
              <FiLayers className="text-base" />
              <span className="text-sm font-medium">Albums</span>
              <FiChevronLeft
                className={`transition-transform duration-200 text-sm ${
                  sidebarVisible ? "rotate-180" : ""
                }`}
              />
            </button>
            <div className="min-w-0 flex-1">
              <h1 className="text-base font-semibold text-primary truncate">
                {oneEvent?.eventName || "Event Name"}
              </h1>
              <p className="text-xs text-gray-500 line-clamp-1">
                {oneEvent?.description || "No description available"}
              </p>
            </div>
          </div>

          <div className="flex items-center gap-1">
            <button
              onClick={() => setShowStatsModal(true)}
              className="lg:hidden flex items-center gap-1 bg-gray-100 p-1.5 rounded-lg text-gray-700 hover:bg-secondary/10 hover:text-secondary transition-all"
            >
              <FiMoreHorizontal />
              <span className="text-xs hidden sm:inline">Details</span>
            </button>

            <div className="hidden lg:flex gap-2">
              {stats.map((item) => (
                <InfoItem key={item.label} {...item} />
              ))}
            </div>

            <div className="hidden sm:flex gap-1">
              {actions.map((action) => (
                <ActionButton key={action.value} {...action} />
              ))}
            </div>
          </div>
        </div>
      </header>

      {showStatsModal && (
        <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
          <div className="bg-white rounded-xl w-full max-w-sm p-4 animate-in fade-in shadow-xl">
            <div className="flex justify-between items-center mb-4">
              <h3 className="font-semibold text-lg text-primary">
                Event Details
              </h3>
              <button
                onClick={() => setShowStatsModal(false)}
                className="p-1 rounded-full hover:bg-gray-100 text-primary transition-colors"
              >
                <FiX />
              </button>
            </div>

            {/* Event Info */}
            <div className="mb-4">
              <h4 className="text-sm font-medium text-primary mb-2">
                Event Information
              </h4>
              <div className="grid gap-2">
                {eventDetails.map((item) => (
                  <div
                    key={item.label}
                    className="flex items-center gap-2 bg-gray-50 p-2 rounded-lg"
                  >
                    <item.icon className="text-secondary text-base flex-shrink-0" />
                    <div className="min-w-0 flex-1">
                      <span className="text-xs text-gray-500 block">
                        {item.label}
                      </span>
                      <span className="text-sm font-medium text-gray-700 truncate block">
                        {item.value}
                      </span>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            {/* Statistics */}
            <div className="mb-4">
              <h4 className="text-sm font-medium text-primary mb-2">
                Statistics
              </h4>
              <div className="grid gap-2">
                {stats.map((item) => (
                  <div
                    key={item.label}
                    className="flex items-center gap-2 bg-gray-50 p-2 rounded-lg"
                  >
                    <item.icon className="text-secondary text-base flex-shrink-0" />
                    <div className="min-w-0 flex-1">
                      <span className="text-xs text-gray-500 block">
                        {item.label}
                      </span>
                      <span className="text-sm font-medium text-gray-700 truncate block">
                        {item.value}
                      </span>
                    </div>
                  </div>
                ))}
              </div>

              {/* Storage Progress Bar */}
              <div className="mt-2 bg-gray-200 rounded-full h-2">
                <div
                  className="bg-gradient-to-r from-secondary to-[#e8d4a6] h-2 rounded-full transition-all duration-300"
                  style={{ width: `${storagePercentage}%` }}
                />
              </div>
              <p className="text-xs text-gray-500 mt-1">
                {storagePercentage.toFixed(1)}% of package storage used
              </p>
            </div>

            {/* Actions */}
            <div className="grid grid-cols-2 gap-2">
              {actions.map((action) => (
                <ActionButton key={action.value} {...action} />
              ))}
            </div>
          </div>
        </div>
      )}
    </>
  );
};

export default Header;





import { cx } from "@/src/utils";
import React, { useState, useCallback, useMemo } from "react";
import { FiHardDrive, FiImage, FiUpload } from "react-icons/fi";

const UploadButton = ({ label, icon, className, onChange }) => (
  <label className={`w-full sm:w-auto ${className}`}>
    {icon}
    <span>{label}</span>
    <input
      type="file"
      multiple
      accept="image/*"
      onChange={onChange}
      className="hidden"
    />
  </label>
);

const UploadSection = ({ currentAlbum, handleFileChange, maxImageSize }) => {
  const [isDragging, setIsDragging] = useState(false);

  const handleDragEvent = useCallback((e) => {
    e.preventDefault();
    e.stopPropagation();
  }, []);

  const handleDragIn = useCallback(
    (e) => {
      handleDragEvent(e);
      if (e.dataTransfer.items?.length) setIsDragging(true);
    },
    [handleDragEvent]
  );

  const handleDragOut = handleDragEvent;

  const handleDrop = useCallback(
    (e) => {
      handleDragEvent(e);
      setIsDragging(false);
      if (e.dataTransfer.files?.length) {
        handleFileChange({ target: { files: e.dataTransfer.files } });
      }
    },
    [handleDragEvent, handleFileChange]
  );

  const uploadButtons = useMemo(
    () => [
      {
        label: "Select",
        icon: <FiImage className="text-sm" />,
        className:
          "bg-primary text-white px-3 py-2 rounded-lg cursor-pointer hover:bg-opacity-90 text-sm flex items-center justify-center gap-1.5 transition shadow-sm hover:shadow",
      },
      {
        label: "Drop Files",
        icon: <FiUpload className="text-sm" />,
        className:
          "bg-gradient-to-r from-secondary to-[#e8d4a6] text-primary px-3 py-2 rounded-lg cursor-pointer hover:from-[#c9b085] hover:to-secondary text-sm font-medium flex items-center justify-center gap-1.5 transition shadow-sm hover:shadow",
      },
    ],
    []
  );

  return (
    <div className="relative bg-white rounded-lg shadow-sm transition-all mb-2">
      {/* Album Header Section */}
      <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 px-3 py-1 border-t border-x border-gray-200 rounded-t">
        <div>
          <h2 className="text-lg font-bold text-primary">
            {currentAlbum.albumName}
          </h2>
        </div>
        <div className="flex gap-3 text-xs text-gray-600">
          <div className="flex items-center gap-1">
            <FiImage className="text-secondary text-sm" />
            {currentAlbum.totalImages || 0} photos
          </div>
          <div className="flex items-center gap-1">
            <FiHardDrive className="text-secondary text-sm" />
            {currentAlbum?.totalMBUsed.toFixed(2)} MB
          </div>
        </div>
      </div>

      <div
        onDragEnter={handleDragIn}
        onDragLeave={handleDragOut}
        onDragOver={handleDragEvent}
        onDrop={handleDrop}
        className={cx(
          "p-3 border-2 border-dashed rounded-b-lg relative",
          isDragging
            ? "border-secondary bg-[#fff9e6]"
            : "border-gray-200 hover:border-secondary"
        )}
      >
        {/* Upload Section */}
        <div className="mb-2 flex justify-center  items-center gap-2 w-full sm:w-auto">
          {uploadButtons.map((btn, idx) => (
            <UploadButton key={idx} {...btn} onChange={handleFileChange} />
          ))}
        </div>

        {isDragging && (
          <div className="absolute inset-0 bg-secondary/10 backdrop-blur-[2px] rounded-lg flex items-center justify-center">
            <div className="text-center p-3">
              <FiUpload size={20} className="mx-auto mb-1 text-primary" />
              <p className="text-primary font-medium text-sm">
                Drop files here
              </p>
            </div>
          </div>
        )}
        <div className="flex flex-col sm:flex-row items-center justify-between gap-1 text-xs text-gray-500">
          <p>JPG, PNG, JPEG supported</p>
          <p className="text-red-500 font-medium">
            *Select files or drag and drop. You can upload up to 1000 images at
            once.*
          </p>
          <p>Max: {maxImageSize}MB per image</p>
        </div>
      </div>
    </div>
  );
};

export default UploadSection;




